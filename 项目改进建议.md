# Blog 项目改进建议

以下建议基于当前仓库结构、服务配置文件与自动化脚本的快速审视，旨在为后续迭代提供路线图。按优先级分组，优先级越高越建议优先投入。

## P0 — 立即跟进（安全 / 稳定性）

- **收敛 JWT 密钥散落问题**：`blog-auth-service/src/main/resources/application.yml`、`blog-article-service/src/main/resources/application.yml`、`blog-user-service/src/main/resources/application.yml` 中均硬编码了同一 Base64 Secret，并将 JWT 解析职责分散到多个服务。建议改由认证服务或 API Gateway 统一颁发与校验，业务服务只消费经过安全层过滤的用户上下文，密钥仅保留在认证域。
- **检查配置文件缺失的 Profile**：`blog-auth-service` 默认激活 `local` Profile，但仓库中无 `application-local.yml`，在生产部署前需要梳理 Profile 体系，避免因为缺失配置导致启动失败或引用错误的密钥。
- **数据库与消息凭证外置化**：`docker-compose.yml` 与各服务配置目前直接暴露账号密码（PostgreSQL、MongoDB、Redis、RabbitMQ）。建议：
  1. 引入 `.env` 管理敏感变量；
  2. 融入 Secret Manager（如 Azure Key Vault、Vault）或部署环境变量注入；
  3. 为生产镜像配置只读账号、最小权限策略。
- **上传目录与静态资源治理**：`blog-user-service` 默认写入 `uploads/avatars`，仓库中已存在示例文件夹。需确认已在 `.gitignore` 里排除动态文件，并针对生产环境准备对象存储或 CDN，避免本地磁盘膨胀与多节点不一致。

## P1 — 架构一致性与代码整洁

- **统一数据访问栈**：文章/用户服务的 `pom.xml` 同时引入了 Spring Data JPA 与 MyBatis-Plus，代码层也混用 Mapper 与 Repository，增加认知负担。建议择一（或划清分工）；若继续使用 MyBatis-Plus，可移除 JPA 相关配置与依赖。
- **抽象跨服务 DTO 与客户端**：目前 Feign Client、DTO 散落在各服务内部。建议在根层引入 `shared-contracts` Maven module，集中定义跨服务请求/响应模型与接口契约，降低重复定义和漂移风险。
- **消息可靠性与幂等**：RabbitMQ 的生产与消费端 (`blog-article-service` / `blog-user-service`) 尚未显式配置 Confirm、Retry、DLQ。建议：
  - 打通 Publisher Confirm 与手动 Ack；
  - 为通知消费方增加幂等校验（基于业务 Key 或消息 ID）；
  - 预先规划重试 / 死信队列策略。
- **鉴权边界优化**：目前文章、用户服务都解析 JWT 并自行校验权限，违反“资源服务器只专注业务”的原则。可引入 Spring Cloud Gateway + Spring Security Resource Server 或共用的 `auth-starter`，统一鉴权切面与异常处理。
- **API 契约可视化**：缺乏统一的 OpenAPI 文档。建议：
  1. 在各服务内引入 `springdoc-openapi`；
  2. 通过独立文档服务或前端 `/docs` 页面集中展示。

## P2 — 开发效率与质量保障

- **测试体系升级**：
  - 单元测试：目前 `blog-article-service` 仅有 `ArticleServiceImplTest`，其余服务缺失。为核心业务（用户注册、登录流程、Token 刷新、通知消费）补齐单测。
  - 集成测试：利用 `testcontainers` 编排 PostgreSQL/MongoDB/Redis/RabbitMQ；对跨服务流程编写 Smoke/Contract 测试。
  - 前端测试：`blog-frontend/package.json` 尚未集成测试工具，建议引入 Vitest + Vue Testing Library，实现组件级与 Store 行为测试。
- **CI/CD 管线**：`docker-compose.yml` 只用于本地。建议先落地 GitHub Actions：
  1. 统一 Maven 构建与前端 `npm ci`；
  2. 运行单元/集成测试与 Lint；
  3. 产出 Docker 镜像并推送到镜像仓库（ACR/ECR 等）。
- **容器化补全**：当前仅 `blog-eureka-server/Dockerfile` 完成，其他服务仍缺镜像定义。建议采用多阶段构建，并为生产与本地提供不同 Compose 覆盖文件（`docker-compose.override.yml` / `docker-compose.prod.yml`）。
- **标准化日志**：为三大业务服务统一引入结构化日志格式（JSON），搭配链路 ID（TraceId、SpanId），为后续接入集中日志或 APM 做准备。
- **脚本跨平台性**：根目录大量 PowerShell 脚本（`start-all-services.ps1` 等），建议补充 `make`/`npm`/`bash` 版本或在 README 中注明 Windows 依赖，以支持 Linux / macOS 团队成员。

## P3 — 可观测性与性能优化

- **分布式追踪**：集成 Micrometer + Zipkin/Tempo，实现服务间调用链定位；同时利用 Resilience4j Metrics 观察熔断触发情况。
- **缓存策略**：热门文章列表、标签信息可引入 Redis 缓存或内容分发策略，降低数据库压力。需搭配失效策略与后台刷新机制。
- **全文搜索规划**：文章搜索目前可能依赖数据库 LIKE 查询，建议调研接入 Elasticsearch / OpenSearch，以支持高阶搜索与推荐场景。
- **性能基线**：建立 Gatling / k6 压测脚本，为文章创建、点赞、通知等关键链路提供性能基线，结合 CI/CD 定期回归。

## P4 — 业务与前端体验

- **通知体验迭代**：`.todo.md` 已记录未读角标与实时刷新需求，可结合 WebSocket / Server-Sent Events 实现消息推送，减少轮询。
- **富文本与安全**：前端依赖 `marked` + `dompurify`，需确保服务端也进行 HTML Sanitizer（防御 XSS），并在存储层保留原始 Markdown 以便二次渲染。
- **国际化与易用性**：若目标用户群包含多语言需求，可在前端引入 `vue-i18n`；后端返回的错误信息也应结构化，便于多语言映射。
- **图片与资源上传扩展**：为未来的文章封面、相册等做前置设计，可抽象统一的文件服务（上传、裁剪、访问权限），并准备 CDN 策略。

## 推荐的执行节奏

1. **安全/配置梳理**：完成 Secret 管理、Profile 校验，确保现有环境可稳定上线。
2. **统一架构基线**：重构数据访问层、抽象共享模块、补齐容器化。
3. **质量体系搭建**：完善测试与 CI/CD，同时接入标准化日志/追踪。
4. **功能体验迭代**：在稳定的基线上推进通知、搜索、内容体验等中长期需求。

以上建议可作为后续路线图的讨论稿，实际优先级需结合团队资源与业务目标进一步细化。祝项目迭代顺利！
